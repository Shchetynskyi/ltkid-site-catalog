# Ключові рішення (SSOT)

Цей документ є **єдиним джерелом продуктових і системних рішень**.
Будь-яка логіка, що впливає на UX, дані або поведінку сайту,
**МУСИТЬ** бути зафіксована тут.

---

## 1. Catalog v2 — Source of Truth

**Status:** ACTIVE

- Google Sheets (`CATALOG_V2`) є **єдиним джерелом правди** для каталогу.
- Сайт працює **виключно в режимі read-only** з SSOT.
- Будь-які зміни структури даних:
  - тільки після усвідомленого рішення,
  - з фіксацією в цьому документі.

---

## 2. Діоптрії

**Status:** FIXED

**Source of truth:**
- колонка `Наявність діоптрій виробника`
- тільки конкретні значення

**Правила:**
- діапазони (MIN–MAX) є похідними
- діапазони НЕ є джерелом даних
- UI НЕ має права інтерпретувати або “вгадувати” діоптрії

---

## 3. Категоризація

**Status:** FIXED

- Категорія **НЕ зберігається** в таблиці.
- Категорія визначається **логікою фронтенду**
  на основі атрибутів моделі.
- У SSOT відсутнє поле `Category`.

---

## 4. Try-On / AI

**Status:** INACTIVE

- Try-On та AI Preview:
  - не інтегровані
  - існують лише як CTA
- Не мають:
  - бізнес-логіки
  - переходів
  - впливу на каталог або замовлення

---

## 5. Глобальні заборони

**Status:** ACTIVE

ЗАБОРОНЕНО:
- додавати нові UX-елементи без рішення в SSOT
- змінювати тексти кнопок
- інтегрувати оплату
- додавати бізнес-логіку без фіксації в `DECISIONS.md`

---

## 6. Site price — загальне рішення

**Status:** FIXED (immutable)

- Канонічна ціна для клієнтського UI — **`SitePriceUAH`**.
- Поля:
  - `Price` — внутрішня / закупочна ціна
  - `PriceIndex` — технічний індекс
- ЖОДНЕ з цих полів **НЕ використовується напряму в UI**.

Будь-які зміни ціни на сайті можливі **тільки через це рішення**.

---

## 7. [P0] SitePriceUAH — Derived column (Google Sheets)

**Status:** FIXED (immutable)

### Призначення
`SitePriceUAH` — **єдине валідне поле ціни для сайту**.

### Джерела
- `PriceIndex` — source of truth
- `PriceMap` — відповідність `PriceIndex → PriceUAH`

### Правила
- колонка `SitePriceUAH`:
  - додається **ТІЛЬКИ** в кінець таблиці `CATALOG_V2`
  - не редагується вручну
  - формується виключно формулою
- якщо значення відсутнє або некоректне → використовується fallback

### UI rule (mandatory)
- якщо `SitePriceUAH` порожня або некоректна → UI показує:
  **“Ціну уточнюйте”**
- числовий fallback на `Price` **ЗАБОРОНЕНО**

### Канонічний патерн формули (Google Sheets)

Через обмеження Google Sheets  
(`ARRAYFORMULA` не пропускає коректно технічний рядок 2)
використовується патерн з порожнім першим елементом масиву,
аналогічний колонці `Preview`.

={"";ARRAYFORMULA(
IF(PriceIndex3:="";
"";
IFERROR(
VLOOKUP(VALUE(PriceIndex3:); PriceMap!A:B; 2; FALSE);
"Ціну уточнюйте"
)
)
)}


Цей патерн є **канонічним** і **не підлягає зміні без окремого рішення**.

---

## 8. Phase 2 — Lead Capture: сценарії та межі відповідальності

**Status:** FIXED (immutable)

### Загальний принцип
Сайт SITE-CATALOG:
- є вітриною та інструментом формування ліда
- НЕ приймає рішень щодо сумісності лінз і рецепта
- НЕ гарантує відповідність зору
- НЕ продає готовий продукт без участі менеджера

Єдина задача сайту — **передати коректний контекст менеджеру**.

---

### Сценарій A — Готові окуляри (без визначення діоптрій)

**CTA:**
- “Звʼязатися з менеджером”

**Контекст:**
- ModelID
- SitePriceUAH
- preview / image (якщо доступно)
- ref = site_catalog__model

---

### Сценарій B — Аправа як товар (без діоптрій)

**CTA:**
- “Звʼязатися з менеджером”

**Контекст:**
- ModelID
- SitePriceUAH (ціна оправи)
- preview / image
- ref = site_catalog__frame

Підбір лінз і робота з рецептом —
**виключно зона відповідальності менеджера**.

---

### Сценарій C — Для мого зору

- не входить у Phase 2
- предмет окремого рішення (Phase 3)
- потребує окремого UX-FLOW

---

## 9. UX-обмеження (Phase 2)

- UX-FLOW v1.1 — **FROZEN**
- нові кнопки типу “Обрати цю” — **ЗАБОРОНЕНІ**
- єдиний CTA на сторінці моделі:
  **“Звʼязатися з менеджером”**
