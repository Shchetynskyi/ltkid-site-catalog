# Ключові рішення (SSOT)

## 1. Catalog v2  Source of Truth
Google Sheets (CATALOG_V2) є єдиним джерелом правди.
Будь-які зміни структури даних  лише через аудит SSOT.

---

## 2. Діоптрії
Source of truth:
- колонка Наявність діоптрій виробника
- тільки конкретні значення
- діапазони є похідними і не є джерелом даних

---

## 3. Категоризація
Категорія НЕ зберігається в таблиці.
Визначається логікою фронтенду на основі даних каталогу.

---

## 4. Try-On / AI
- не інтегровані
- існують лише як CTA
- не мають бізнес-логіки або переходів

---

## 5. Заборони
Заборонено:
- додавати нові UX-елементи без оновлення SSOT
- змінювати тексти кнопок
- інтегрувати оплату
- додавати логіку без рішення в DECISIONS.md

## Gallery width filter — active button disappearing

### Problem
Активна кнопка фільтра ширини оправи зникала з UI.
Фільтрація по даних працювала, URL був коректний.

### Root cause
CSS-стилі для `<button>` перекривались user-agent стилями браузера.
Активний стан (`.active`) візуально губився, хоча DOM і state були коректні.

### Decision
Явно зафіксовано стилі кнопок фільтра в scoped CSS галереї.
Активний стан тепер стабільно рендериться незалежно від браузера.

### Scope
Frontend only.
Дані каталогу, URL-логіка та UX не змінювались.

[2026-01-14] Документи SSOT розділено по ролях:

— PROJECT.md: що це за продукт і його межі
— DECISIONS.md: продуктові та системні рішення
— STATUS.md: фактичний стан реалізації
— UX-FLOW.md: екрани, переходи, CTA (UX SSOT)

UX-логіка НЕ дублюється в інших документах.

[2026-01-14] UX-FLOW v1.1 зафіксовано як ACTIVE / SOURCE OF TRUTH для екранів, переходів і CTA.

[2026-01-14] Site price source

— Канонічна ціна для сайту: `PriceIndex`
— Колонка `Price` вважається ціною виробника і не використовується як основна ціна на UI
— Будь-які зміни ціни на UI виконуються тільки через це рішення (SSOT)

## [P0] SitePriceUAH — Derived column pattern (Google Sheets)

SitePriceUAH є похідною колонкою для сайту.
Джерело:
- PriceIndex — source of truth
- PriceMap — мапінг PriceIndex → PriceUAH

Колонка додається ТІЛЬКИ в кінець таблиці CATALOG_V2.

Через обмеження Google Sheets (ARRAYFORMULA не вміє коректно
пропускати технічний рядок 2) використовується патерн
з порожнім першим елементом масиву:

={"";
  ARRAYFORMULA(
    IF(PriceIndex3:="";
       "";
       IFERROR(
         VLOOKUP(VALUE(PriceIndex3:); PriceMap!A:B; 2; FALSE);
         "Ціну уточнюйте"
       )
    )
  )
}

Патерн аналогічний використаному в колонці Preview.
